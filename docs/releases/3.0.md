# GradleUtils 3

GradleUtils 3 is a new release of GradleUtils that includes a compete rewrite of
the plugin, along with its components. It is now written for Java version 17 and
targets Gradle 9.0.0.

## Additions

### GradleUtils Shared

As part of the update process, several of Forge's Gradle plugins have started to
share similar code that did many of the same things. To reduce the amount of
duplicate code between projects, `gradleutils-shared` was created to be an
agnostic base that holds a lot of the base code for plugins to extend from. This
shared base is mostly intended for internal use by Forge's Gradle plugins, but
can be used by others as well.

All plugins that use the shared base *must* shadow it into their release jars.
The shared base will not be published onto Maven Central, and thus a dependency
on it from a plugin will cause a resolution error if not shadowed (Gradle Plugin
Portal mirrors Maven Central). GradleUtils itself is built on this shared base,
and thus shadows it in its release as well.

### Proper API Isolation

GradleUtils now exposes proper API interfaces as opposed to full-on Groovy
classes. The implementations of these classes implement Gradle's `HasPublicType`
interface, so they will be linted by IDEs correctly. The goal is to allow
implementations to change dynamically without accidentally adding or removing
public members.

> [!WARNING]
> There is a known issue with IntelliJ's Gradle Groovy DSL linter where plugins
> that are applied to `settings.gradle` do not have any linting in either that
> file or in the `build.gradle` if it is later applied in the project.

### Proper Errors and Warnings

GradleUtils now takes full advantage of Gradle's incubating Problems API to
report problems with as much detail as is available. IDEs are beginning to
adopt the Problems API, with the first one being Eclipse (disabled by default,
check settings).

Exceptions that are thrown with problems attached to them by GradleUtils will
have increased details in the error message on the console window, visible in
terminals and IDEs. GradleUtils shared also includes a base class for other
plugins to make problem reporters as well, allowing plugins such as ForgeGradle
to have better debugging and errors.

> [!WARNING]
> This feature is still experimental, and there may be some cases where an error
> is thrown that GradleUtils has not provided extra details on. Additionally,
> the Problems API is still incubating, and changes to it can be made at any
> time which can break GradleUtils in a minor update of Gradle 9.x.

### Integration with FreeFair's JavaDoc Links plugin

GradleUtils now includes a `JavadocLinkProvider` service that can be used by
the `io.freefair.javadoc-links` plugin's `resolveJavadocLinks` task to include
additional known links in JavaDocs. As of 3.0.0, this includes redirecting
Gradle API redistribution links, such as `name.remal.gradle-api:gradle-api` and
`dev.gradleplugins:gradle-api`, to the JavaDocs hosted by Gradle themselves.

> [!CAUTION]
> Due to how the class loader handles plugins, the `io.freefair.javadoc-links`
> *must be declared* before `net.minecraftforge.gradleutils`. It does not have
> to be applied, just declared.
> ```groovy
> plugins {
>     id 'io.freefair.javadoc-links' version '8.14' apply false
>     id 'net.minecraftforge.gradleutils' version '3.0.0'
> }
> ```
> This is because as GradleUtils's `JavadocLinkProvider` service is loaded, the
> implementing class must exist. If this is not done, an error will be displayed
> letting you know to do this, so you won't be left in the dark.

## Changes

### Proper Configuration Caching

GradleUtils now primarily uses services from Gradle that are friendly with the
configuration cache, and any changes that GradleUtils itself could make will now
invalidate it. This includes using `ProviderFactory#environmentVariable` over
`System#getEnv`, `ProviderFactory#systemProperty` over `System#getProperty`, and
`ProviderFactory#gradleProperty` over `Project#getProperty`. In GradleUtils's
case, this improves maven publishing since it uses environment variable to get
publishing info.

### Plugin Application

GradleUtils is no longer restricted to only plugins. It can now be applied to
any type of `ExtensionAware`, which includes the `settings.gradle`. Projects
that apply the plugin will now use a subset of the `gradleutils` extension that
includes project-specific members, such as `gradleutils.pom`.

### Release Maven Publishing

GradleUtils now supports using the environment variable `MAVEN_URL` over
`MAVEN_URL_RELEASE`. Both are valid, but the former will take priority. With the
removal of conditional snapshot publishing, `gradleutils.publishingForgeMaven`
is now accessible from any plugin target, not just projects.

### PomUtils

`PomUtils` can no longer be accessed statically. It will always be accessible
via `gradleutils.pom`.

Additionally, the `setGitHubDetails` method has been renamed to
`addRemoteDetails` to better describe its intended purpose. Additional details
will automatically be added for repositories that are on GitHub.com and/or are
a part of the MinecraftForge organization.

## Removals

### Git Version Info

The most important change is the removal of the Git version info (accessible in
2.x via `gradleutils.gitInfo`), along with its related methods for calculating
version numbers. This logic is now contained in a new plugin,
`net.minecraftforge.gitversion`, which is *not* applied by GradleUtils. The same
is true for changelog generation, which is now exclusive to the
`net.minecraftforge.changelog` plugin.

### Snapshot Maven Publishing

GradleUtils will no longer automatically conditionally publish to a snapshot
maven. GradleUtils is primarily a tool used by Minecraft Forge, and we no longer
have a repository dedicated solely to snapshot builds. This means that the
`MAVEN_URL_SNAPSHOT` environment variable will no longer have any effect, and it
should not be used.

### ConfigureTeamCity Task

The `configureTeamCity` task has been removed from GradleUtils. Forge no longer
uses TeamCity.

### Artifact Promotion

In GradleUtils 2.6, an experimental task type `PromoteArtifact` could be used to
promote an artifact on the Forge Files site. This has since been removed, as
there are plans to automate the process of artifact promotion on the maven
itself.
